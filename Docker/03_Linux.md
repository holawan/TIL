# 리눅스 사용법 요약

## 리눅스 파일 시스템 및 사용자 관리

### 리눅스와 파일

- 모든것은 파일이라는 철학을 따름
    - 하드웨어등도 다 파일로 처리함 
        - 파일? 
            - 읽고 쓸 수 있다. 
    - 모든 인터렉션은 파일을 읽고, 쓰는 것처럼 이루어져 있음
    - 마우스, 키보드와 같은 모든 디바이스 관련된 기술도 파일과 같이 다뤄짐
- 파일 네임스페이스
    - A드라이브 (A:/), C드라이브 (C:/windows) (x)
    - 전역 네임스페이스 사용
        - /media/floofy/deve.jpg

### 쉘

- 쉘(shell) : 사용자가 컴퓨터 하드웨어 또는 운영체제간 인터페이스
    - 사용자의 명령을 해석해서, 커널에 명령을 요청해주는 역할
    - 관련된 시스템콜을 사용해서 프로그래밍이 작성되어 있다.
- GUI, CLI 모두 shell이라고 볼 수 있다. 
- 보통 CLI shell은 이름이 있는데, 여러가지 이름이 있다. 
    - Mac은 zsh 등

#### 쉘 종류

- Bourne-Again Shell(bash) : GNU 프로젝트의 일환으로 개발됨, 리눅스 거의 bash를 default로 사용함 ! 
- Bourne Shell (sh)
    - 기본 쉘 
- C Shell (csh)
- Korn Shell (ksh) : 유닉스에서 가장 많이 사용됨 
- 등등.. 

### 리눅스 기본 명령어 정리

- 리눅스 명령어는 결국 쉘이 제공하는 명령어이다.
- 리눅스 기본 쉘이 bash이므로, bash에서 제공하는 기본 명령어를 알 필요가 있음

#### 로그인

```bash
ssh -i docker.pem ubuntu@3.34.156.196
```

- 3.34.156.196에 ubuntu라는 id로 로그인하기 
- pem키는 AWS에서 발급받은 키 

#### whoami : 로그인한 사용자 ID

```bash
ubuntu@ip-172-31-42-165:~$ whoami
ubuntu
```

- Linux나 Unix계열은 컴퓨터 한대에 여러명이 다중사용하는 것에 특화되어있는 운영체제이다.
- 따라서 로그인을 해서 들어가면 ID가 있음. 
- window에는 슈퍼 사용자가 있는데, 대부분 개인 pc이기 때문에 본인 계정이 super user이다.
- Linux에는 root가 superuser이다.
    - 하지만, 다중사용자가 사용하기 때문에 super관리자인 root로 명령을 실행하면 모든게 허용되며 복구되지 않을 가능성이 있다.
    - ex) ```rm -rf *```라고 입력하면 모든게 다 삭제되지만 alert이 없다.  
- root : 슈퍼 관리자 ID 

#### sudo 명령어 : root 권한으로 실행

- root 계정으로 로그인하지 않은 상태에서 root 권한이 필요한 명령을 실행할 수 있도록 하는 프로그램

- window로 치면 관리자 권한으로 실행하기의 역할 

- 기본 사용법

    - sudo 명령어

- 사용 예 

    - ```sudo apt-get update ```
    - 리눅스 여러 패키지 중 우리는 ubuntu를 사용하는데, 각각 프로그램이 수시로 업데이트 된다. 
    - 그런 프로그램이 어딘가에 저장되어 있는데, sudo apt-get update는 패키지의 최신 정보를 업데이트한 명령이다.
    - 이 update된 최신 버전으로 패키지 업데이트 및 최신버전을 설치 할 수 있다.

    

#### pwd : 현재 디렉토리 위치

 ```bash
 ubuntu@ip-172-31-42-165:~$ pwd
 /home/ubuntu
 ubuntu@ip-172-31-42-165:~$ cd ..
 ubuntu@ip-172-31-42-165:/home$ pwd
 /home
 ```

#### ls : 파일 목록 출력 

```bash
ubuntu@ip-172-31-42-165:~$ ls

ubuntu@ip-172-31-42-165:~$ ls -a 
.   .bash_logout  .cache    .ssh
..  .bashrc       .profile  .sudo_as_admin_successful

ubuntu@ip-172-31-42-165:~$ ls -al
total 28
drwxr-xr-x 4 ubuntu ubuntu 4096 Aug 25 13:20 .
drwxr-xr-x 3 root   root   4096 Aug 25 09:47 ..
-rw-r--r-- 1 ubuntu ubuntu  220 Feb 25  2020 .bash_logout
-rw-r--r-- 1 ubuntu ubuntu 3771 Feb 25  2020 .bashrc
drwx------ 2 ubuntu ubuntu 4096 Aug 25 11:08 .cache
-rw-r--r-- 1 ubuntu ubuntu  807 Feb 25  2020 .profile
drwx------ 2 ubuntu ubuntu 4096 Aug 25 09:47 .ssh
-rw-r--r-- 1 ubuntu ubuntu    0 Aug 25 13:20 .sudo_as_admin_successful  
```

- ls -a
    - 숨김파일 출력 
- ls -al
    - 현재폴더와 상위폴더가 나오고 숨김파일과 권한까지 출력 



#### 리눅스와 권한

- 운영체제는 사용자/리소스 권한을 관리
- 리눅스는 사용자/그룹으로 권한을 고나리
- root는 슈퍼 관리자
- 파일마다 소유자, 소유자 그룹, 모든 사용자(기타, 모두, Anonymous)에 대해 
    - 읽고, 쓰고, 실행하는 권한을 관리
    - 각 권한에 따라 권한을 설정하고 기록한다. 

- d는 폴더를 의미 

| 권한 | 대표문자 | 파일일 때 | 폴더일 때      |
| ---- | -------- | --------- | -------------- |
| 읽기 | r        | 읽고 카피 | ls 명령어 가능 |
| 쓰기 | w        | 수정      | 파일 생성 가능 |
| 실행 | x        | 실행      | cd 접근 가능   |

**- rwx rw- r-x**

- rwx : 소유자의 권한
- rw : 그룹의 권한
- r-x : 기타 사용자의 권한 

#### 파일 권한

- 사용자
    - 소유자 : 소유자에 대한 권한
    - 그룹:  소유자가 속해 있는 그룹에 대한 권한
    - 공개 : 모든 사용자들에 대한 권한
- 퍼미션 종류, (권한 기호)
    - 읽기(r) : 읽기 권한
    - 쓰기(w) : 쓰기 권한
    - 실행(x) : 실행 권한

#### chmod : 파일 권한 변경

- 숫자를 사용하는 방법

- 소유자(u)

    | 표기 | r       | w       | x       |
    | ---- | ------- | ------- | ------- |
    | 최대 | 2^2 = 4 | 2^1 = 2 | 2^0  =1 |

    합 : 7 

- 그룹(g)

    | 표기 | r       | -       | x       |
    | ---- | ------- | ------- | ------- |
    | 최대 | 2^2 = 4 | 2^1 = 2 | 2^0  =1 |

​		합 : 5

- 기타 (o)

    | 표기 | r       | -       | -       |
    | ---- | ------- | ------- | ------- |
    | 최대 | 2^2 = 4 | 2^1 = 2 | 2^0  =1 |

​		합 : 4 

```bash
rwxrwxrwx = 777
r-xr-xr-x = 555
r-------- = 400
rwx------ = 700
```

```bash
chmod 400 my-key-pair.pem
```

- 하위 폴더 포함 모든 권한 다주기
    - chmod -R 777 directory

#### cat : 파일 보기

```bash
cat nginx.conf
# ngin.conf 파일 내용이 모두 출력됨 
```

#### rm : 파일 및 폴더 삭제

- 주로 사용하는 명령어 형태 : rm -rf 디렉토리 명 
- r 옵션 : 하위 디렉토리를 포함한 모든 파일 삭제
- f 옵션 : 강제로 파일이나 디렉토리 삭제

```bash
rm -r test/
```

- 리눅스는 휴지통이 기본적으로 없기 때문에 확인하고 사용할 것 ! 



## 리다이렉션과 파이프

### Standard Stream(표준 입출력)

- command로 실행되는 프로세스는 세가지 스트림을 가지고 있음
- unix 계열의 명령은 항장 기본적인 세가지 스트림을 가지고 있음
    - 표준 입력 스트림 (Standard Input Streame) - stdin
    - 표준 출력 스트림 (Standard Output Stream) - stdout
    - 오류 출력 스트림 (Standard Error Stream) - stderr
- 모든 스트림은 일반적인 **plain text로 console에 출력**하도록 되어 있음 

- 기본적으로 입력,출력의 스트림이 있고, 이를 변환해주는 것이 리다이렉션과 파이프이다.



### 리다이렉션(redirection)

- 표준 스트림 흐름을 바꿔줄 수 있다.
    - ```>, <```를 사용함
    - 주로 명령어 표준 출력을 화면이 아닌 파일에 쓸 때 
    - 기존 파일이 있다면, 덮어씌워짐

**ex)**

1. ls > files.txt
    - ls로 출력되는 표준 출력 스트림의 방향을 files.txt로 바꿔줌 (files.txt에 ls로 출력되는 결과가 저장됨)
2. head < files.txt
    - files.txt의 파일 내용이 head라는 파일의 처음부터 10라인까지 출력해주는 명령으로 넣어짐(files.txt의 앞 10라인이 출력됨)

- 기존 파일에 추가는``` >>``` 또는 ```<< ```사용 
    - ls >> files.txt
    - 기존에 있는 files.txt 파일 끝에, ls 출력 결과를 추가해줌 

### 파이프

- 두 프로세스 사이에서 한 프로세스의 출력 스트림을 또다른 프로세스의 입력 스트림으로 사용할 때 이용
- ```|```를 사용함

**ex)**

1. ls |grep files.txt
    - ls 명령을 통한 출력 내용이 grep 명령의 입력 스트림으로 들어감
    - grep files.txt는 grep 명령의 입력 스트림을 검색해서 files.txt가 들어가 있는 입력 내용만 출력함
    - 따라서, ls 명령으로 해당 디렉토리/파일 중에 files.txt 파일이 있는지 출력해줌

```bash
ubuntu@ip-172-31-42-165:~$ ls -al | grep bash
-rw------- 1 ubuntu ubuntu  569 Aug 25 19:38 .bash_history
-rw-r--r-- 1 ubuntu ubuntu  220 Feb 25  2020 .bash_logout
-rw-r--r-- 1 ubuntu ubuntu 3771 Feb 25  2020 .bashrc
```

#### 참고 : grep 명령어 

- grep : 검색 명령
- grep [-option] [pattern] [file or directory name]

- \<options>
    - -i : 영문의 대소문자를 구별하지 않는다.
    - -v : pattern을 포함하지 않는 라인을 출력한다.
    - -n : 검색 결과의 각 행의 선두에 행 번호를 넣는다. (first line is 1)
    - -l : 파일명만 출력한다.
    - -c : 패턴과 일치하는 라인의 개수만 출력한다.
    - -r : 하위 디렉토리까지 검색한다. 

## 프로세스 관리

### 프로세스 vs 바이너리

- 코드 이미지 또는 바이너리 : 실행파일
- 실행중인 프로그램 : 프로세스
    - 가상 메모리 및 물리 메모리 정보
    - 시스템 리소스 관련 정보
    - 스케쥴링 단위

#### 실행과정

- c언어의 경우 코드를 작성하면 컴파일이라는 과정을 거친다.
- 컴파일을 하게되면, 실행파일이 나오게 된다 (ex. .exe)
    - 이 과정에서 산출된 실행파일이 0과 1 형태로 되어있기 때문에 바이너리라고 한다. 
- 이런 바이너리는 실제로 운영체제가 실행되면 프로세스로 바꾸어서 실행되게 된다.
- 바이너리의 일정 코드부분을 메모리에 넣고, 운영체제가 메모리에 있는 코드를 운영체제가 정의한 포맷과 단위에 따라 실행하면서 응용프로그램이 실행된다. 

#### 리눅스는 다양한 프로세스 실행 환경

- 리눅스는 기본적으로 다양한 프로세스가 실행됨
    - 유닉스 철학 : 여러 프로그램이 서로 유기적으로 각자의 일을 수행하면서 전체 시스템이 동작하도록 하는 모델 
    - ```ls -al | grep bash``` 라는 명령은 파일 목록을 보는 명령과, bash라는 이름이 들어간 파일을 출력하는 명령이다.
        - 이러한 기능을 하나의 응용프로그램에 넣지 않고 각각 기능을 하게 한 후 유기적으로 사용자가 원하는 형태로 출력하게 하는 것이 유닉스의 철학이다. 

### foreground process / background process

- foreground process : 쉘(shell)에서 해당 프로세스 실행을 명령한 후, 해당 프로세스 수행 종료까지 사용자가 다른 입력을 하지 못하는 프로세스

    - 보통의 프로세스를 의미하며, 끝나기전에 타이핑을 해도 작동하지는 않는다. 
    - [CTRL] + c : 프로세스 작업 취소 (해당 프로세스는 완전히 종료)

- background process : 사용자 입력과 상관없이 실행되는 프로세스

    - 뒤에서 실행시키는 것 
    - 쉘(shell)에서 해당 프로세스 실행 시, 맨 뒤에는 &를 붙여줌
    - 터미널이 하나일지라도 여러가지 명령을 실행할 수 있다. 

    ```bash
    find / -name '*.py' > list.txt &
    [1] 57
    ```

    [1]은 작업 번호 (job number), 57은 pid(process ID) 를 나타냄 



### 프로세스 상태 확인 -ps 명령어

- 사용법 : ps [option(s)]
- option(s)
    - -a : 시스템을 사용하는 모든 사용자의 프로세스 출력 (보통 aux와 같이 u, x 옵션과 함께 사용)
    - -u : 프로세스 소유자에 대한 상세 정보 출력
    - -l : 프로세스 관련 상세 정보 출력
    - -x 
        - 터미널에 로그인한 후 실행한 프로세스가 아닌 프로세스들도 출력함.
        - 주로 데몬 프로세스(daemon process)까지 확인하기 위해 사용.
        - 본래 ps 명령은 현재 쉘(shell)에서 실행한 프로세스들만 보여주기 때문에 이 옵션을 사용하는 경우가 많음
    - -e : 해당 프로세스와 관련된 환경변수 정보도 함께 출력
    - -f : 프로세스간 관계 정보도 출력 
- 데몬 프로세스 : daemon은 악마를 의미함. 사용자 모르게 시스템 관리를 위해 실행되는 프로세스로 보통 시스템이 부팅될 때 자동 실행(예 : ftpd, inetd 등)

- 주요 ps 출력 정보 항목
    - USER : 프로세스를 실행시킨 사용자 ID
    - PID : 프로세스 ID
    - %CPU : 마지막 1분 동안 프로세스가 사용한 CPU시간의 백분율
    - %MEM : 마지막 1분 동안 프로세스가 사용한 메모리 백분율
    - VSZ : 프로세스가 사용하는 가상 메모리 크기
    - RSS : 프로세스에서 사용하는 실제 메모리 크기
    - STAT : 프로세스 상태
    - START : 프로세스가 시작된 시간
    - TIME : 현재까지 사용된 CPU 시간 (분:초)
    - COMMAND : 명령어 

### 프로세스 중지시키기

- kill 명령어

- 보통 프로세스 id로 많이 종료시킴 

- 사용법 

    - kill % 작업 번호(job number)
    - kill 프로세스 ID (pid)
    - 작업 강제종료 옵션 -9 

    ```bash
    find / -name '*.py' > list.txt& 
    [1] 57
    kill -9 57
    ```

### 주로 사용하는 프로세스 명령

- ps aux|grep 프로세스 명 : 프로세스가 실행중인지 확인하고, 관련 프로세스에 대한 정보 출력
- kill -9 프로세스 ID(pid) : 해당 프로세스를 강제로 종료
- 명령 & : 터미널에서 다른 작업을 해야하거나, 프로세스 실행에 오랜 시간이 걸릴 경우 background로 실행
- [CTRL] + c : 프로세스 종료(실행 취소 )



## 하드링크와 소프트링크

### 하드링크와 소프트링크

- cp 명령 : 파일 복사
    - 1MB 사이즈를 가지고 있는 A파일을 B파일로 복사
        - cp A B -> A와 B는 각각 물리적으로 10MB 파일로 저장

```bash
ubuntu@ip-172-31-42-165:~$ lslist.txt
ubuntu@ip-172-31-42-165:~$ cp list.txt a.txt
ubuntu@ip-172-31-42-165:~$ lsa.txt  list.txt
```

- ``` cp -rf * 폴더명 ```

    -  현재 폴더의 모든 파일과 하위폴더의 모든 파일을 다른 파일에 통채로 복사 

- 하드링크 : In A B

    - A와 B는 동일한 10MB파일을 가리킴
    - 즉, 동일한 파일을 가진 이름을 하나 더 만든 것일 뿐
        - 전체 파일 용량은 달라지지 않음 

    - ``` ln a.txt b.txt```
        - A파일과 B파일을 완전히 동일한 상태로 만듬
        - 해당 명령 이후 A파일을 수정하면 B파일도 수정됨 
    - rm A로 A를 삭제해도 B에 접근 가능 

- 소프트(심볼릭)링크 : ln -s A B 

    - Windows OS의 바로가기와 동일
    - ls -al 하면 소프트링크 확인 가능

    ```bash
    lrwxr-xr-x link3.txt -> link2.txt
    ```

    - rm A로 A를 삭제하면 B는 남아있으나, 해당 파일 접근 불가 

- 하드링크/소프트 링크 둘다 어느 하나 파일을 수정하면, 각 파일 이름으로 동일한 내용 접근 가능 



## 우분투 패키지 관리 

### ubuntu 배포판

- 다양한 배포판 중 하나
- 데비안 배포판을 기반으로 캐노니컬 사가 우분투 배포판 개발
    - 데비안 배포판은 apt 프로그램을 이용해서 소프트웨어 설치 및 업데이트를 간편하게 한 패키지
- 우분투 의미 : 남아프리카 부족 언어로 '너가 있으나 나도 있다'라는 의미
    - 우분투 데스크탑 배포판 (X윈도우 기반, GUI 환경 기본 제공)과 우분투 서버 배포판, 두가지 기본 배포판을 제공
    - 지원 기간이 짧은 일반 버전과 지원기간이 장기(5년)인 LTS(Long Term Support) 버전으로 나눠서 발표 

### ubuntu 패키지 관리자

- CentOS나 Fedora와 같은 RedHat 계열 배포판은 RPM이라는 패키징 시스템을 사용함
- ubuntu와 같이 데비안 계열 배포판은 deb라는 패키징 시스템을 사용함
- 패키지와 패키지 정보를 저장하고 있는 패키지 저장소라는 개념을 가지고 있음
- 소프트웨어 패치, 추가등 정보를 관리
- 우분투 사용자가 패키지 관리자를 통해 패키지 저장소에 접근하면, 소프트웨어 변경사항을 알려주고 업데이트, 다운로드 등을 지원

### ubuntu 패키지 관리 실무

- ubuntu 패키지 인덱스 정보 업데이트(배포판 버전에 따른 패키지 업데이트 버전 정보 등)
    - 프로그램을 다운로드 받으면 저장된 위치가 있는데, 이 위치 정보 리스트를 관리할 수 있다. 
    - 위치가 추가되면 각각 위치에 접속해서 프로그램의 각 버전과 정보를 받아와야 할 필요가 있다.
    - 이가 패키지 인덱스 정보이다. 
    - 우리는 ubuntu를 처음 받을 때 update를 먼저 할 필요가 있다. 
    - sudo : 관리자 권한으로 실행 

```bash
sudo apt-get update
```

- 설치된 ubuntu  패키지 업그레이드(함부로 하지 말 것)
    - 시스템 자체가 망가질 우려가 있다.
    - 시스템은 모두가 잘 맞아야 돌아가는데 upgrade는 인덱스 기반 정보로 현재 linux에 있는 모든 프로그램을 최신버전으로 upgrate하는 것이기 때문에 상호작용이 잘 되지 않을 수 있다.

```bash
sudo apt-get upgrade
```

- 패키지 설치

    ```bash
    sudo apt-get install 패키지명
    ```

- 패키지 삭제(설정파일 제외)

```bash
sudo apt-get remove 패키지명
```

- 패키지 삭제(설정파일 포함)

```bash
sudo apt-get --purge remove 패키지명
```

## VIM

### VIM 에디터 이해 및 설치

- VIM : Vimproved에서 앞글자를 빼내어 만든 이름
    - Vi : 전통적인 유닉스 에디터(개발자: 빌 조이), Visual Editor의 줄임말
    - Vim 은 Vi에 자동화, 시각화 메뉴를 추가한 프로그램
    - Vim 이외에 이맥스(Emacs, GNU 프로젝트 설립자 리차드 스톨만이 개발)라는 유명한 에디터가 있음 (대부분 개발자는 두 에디터 중 하나를 사용함)

- 설치
    - 윈도우/맥 : https://vim.sourceforge.io/download.php
    - 리눅스 : sudo apt-get install vim

### vim 네가지 모드

- 일반(명령)모드 : 처음 vim을 실행했을 때 또는 입력 모드/명령 모드에서 ESC 입력 시 -찾기, 커서 이동 등
- 명령(명령행) 모드 : 일반 모드에서 : 입력 시 - 저장, 파일 읽기, vim 설정 등
- **입력(편집)모드 : 일반모드에서 a 또는 i 또는 o키 입력 시 - 내용 입력**
- Visual 모드 : 일반 모드에서 v 입력 시 - 블럭 복사/ 붙이기

### vim 초간단 사용법

- 입력

    ```bash
    i 포커스가 잡힌 커서 위치에서 편집모드 시작
    ```

- 삭제(일반 모드에서 실행해야함)

    ```bash
    x 커서의 한 문자를 삭제
    ```

- 파일 저장

    ```bash
    :w 현재 오픈된 파일 저장
    :q 저장하지 않고 종료 (quit)
    :wq 현재 오픈된 파일 저장 후 종료
    :q! 강제종료(대소문자 구분 )
    ```

    

